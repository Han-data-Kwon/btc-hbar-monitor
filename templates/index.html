<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ê³ ë˜ ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-streaming@2.0.0"></script>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background-color: white;
      color: black;
      margin: 0;
      padding: 20px;
      transition: background-color 0.3s, color 0.3s;
    }
    .dark-mode {
      background-color: #121212;
      color: white;
    }
    h1 {
      font-size: 32px;
    }
    .tabs button {
      margin-right: 10px;
      padding: 10px 15px;
      font-size: 16px;
      border: 1px solid #ccc;
      background-color: #eee;
      cursor: pointer;
      border-radius: 6px;
    }
    .tabs button.active {
      background-color: white;
      font-weight: bold;
      border: 2px solid black;
    }
    .content {
      margin-top: 20px;
    }
    .card {
      display: inline-block;
      border: 1px solid #ccc;
      border-radius: 10px;
      padding: 20px;
      margin: 10px;
      width: 250px;
      vertical-align: top;
    }
    .news-card img {
      width: 100%;
      height: 100px;
      object-fit: cover;
    }
    .dark-mode .card {
      background-color: #222;
      color: white;
      border: 1px solid #555;
    }
    .toggle-btn {
      float: right;
      padding: 8px 16px;
      font-size: 14px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      padding: 10px;
      border: 1px solid #ddd;
    }
    th {
      background-color: #f2f2f2;
    }
    .dark-mode th {
      background-color: #333;
    }
  </style>
</head>
<body>
  <h1>ğŸ‹ ê³ ë˜ ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ</h1>
  <button class="toggle-btn" onclick="toggleDarkMode()">ğŸŒ™ ë‹¤í¬ëª¨ë“œ</button>

  <div class="tabs">
    <button class="tab-btn active" onclick="showTab('price')">ğŸ’° ì‹œì„¸</button>
    <button class="tab-btn" onclick="showTab('news')">ğŸ“° ë‰´ìŠ¤</button>
    <button class="tab-btn" onclick="showTab('economics')">ğŸ“Š ê²½ì œì§€í‘œ</button>
    <button class="tab-btn" onclick="showTab('whales')">ğŸ³ ê³ ë˜ ê±°ë˜</button>
  </div>

  <div id="price" class="content">
    <h2>ğŸ’° ì£¼ìš” ì½”ì¸ ì‹œì„¸</h2>
    <div id="price-cards"></div>
  </div>

  <div id="news" class="content" style="display: none;">
    <h2>ğŸ“° Cointelegraph ë‰´ìŠ¤</h2>
    <div id="news-section"></div>
  </div>

  <div id="economics" class="content" style="display: none;">
    <h2>ğŸ“Š ì£¼ìš” ê²½ì œì§€í‘œ</h2>
    <table>
      <thead>
        <tr>
          <th>ë‚ ì§œ</th><th>ì§€í‘œëª…</th><th>êµ­ê°€</th><th>ì´ì „</th><th>ì˜ˆì¸¡</th><th>ì‹¤ì œ</th><th>í•´ì„</th>
        </tr>
      </thead>
      <tbody id="eco-table"></tbody>
    </table>
  </div>

  <div id="whales" class="content" style="display: none;">
    <h2>ğŸ³ ê³ ë˜ ê±°ë˜</h2>
    <p>ì´ì „ ê³ ë˜ ê±°ë˜ íƒ­ ì½”ë“œ ìœ ì§€</p>
  </div>

  <script>
    function toggleDarkMode() {
      document.body.classList.toggle("dark-mode");
    }

    function showTab(id) {
      document.querySelectorAll(".content").forEach(el => el.style.display = "none");
      document.querySelectorAll(".tab-btn").forEach(btn => btn.classList.remove("active"));
      document.getElementById(id).style.display = "block";
      event.target.classList.add("active");
    }

    // ì‹œì„¸ ë¶ˆëŸ¬ì˜¤ê¸°
    fetch('/api/price')
      .then(res => res.json())
      .then(data => {
        const container = document.getElementById('price-cards');
        Object.entries(data).forEach(([symbol, info]) => {
          const color = info.change >= 0 ? 'green' : 'red';
          container.innerHTML += `
            <div class="card">
              <h3>${symbol}</h3>
              <p style="color:${color}">$ ${info.price}</p>
              <p style="color:${color}">ğŸ“‰ ë³€í™”ìœ¨: ${info.change}%</p>
              <canvas id="chart-${symbol}" height="50"></canvas>
            </div>`;
        });

        // ë”ë¯¸ ì°¨íŠ¸ ìƒì„±
        Object.keys(data).forEach(symbol => {
          const ctx = document.getElementById(`chart-${symbol}`).getContext('2d');
          new Chart(ctx, {
            type: 'line',
            data: {
              labels: ["1H", "30M", "15M", "5M", "1M"],
              datasets: [{
                label: symbol,
                data: Array.from({length: 5}, () => Math.random() * 1000),
                borderWidth: 1,
                fill: false,
              }]
            },
            options: {
              plugins: { legend: { display: false } },
              scales: { x: { display: false }, y: { display: false } }
            }
          });
        });
      });

    // ë‰´ìŠ¤ ë¶ˆëŸ¬ì˜¤ê¸°
    fetch('/api/news')
      .then(res => res.json())
      .then(news => {
        const container = document.getElementById('news-section');
        news.forEach(article => {
          container.innerHTML += `
            <div class="card news-card">
              <img src="${article.image}" />
              <h4><a href="${article.link}" target="_blank">${article.title}</a></h4>
              <small>${article.date}</small>
            </div>`;
        });
      });

    // ê²½ì œì§€í‘œ ë¶ˆëŸ¬ì˜¤ê¸°
    fetch('/api/economics')
      .then(res => res.json())
      .then(data => {
        const table = document.getElementById('eco-table');
        if (data.length === 0) {
          table.innerHTML = '<tr><td colspan="7">í‘œì‹œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
          return;
        }
        data.forEach(item => {
          table.innerHTML += `
            <tr>
              <td>${item.date}</td>
              <td>${item.event}</td>
              <td>${item.country}</td>
              <td>${item.previous || '-'}</td>
              <td>${item.forecast || '-'}</td>
              <td>${item.actual || '-'}</td>
              <td>${item.effect}</td>
            </tr>`;
        });
      });
  </script>
</body>
</html>