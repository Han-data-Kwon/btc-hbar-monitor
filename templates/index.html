<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>📈 실시간 고래 모니터링 대시보드</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial; background: #fff; color: #000; margin: 20px; }
    .tab { display: none; }
    .tab.active { display: block; }
    button { margin: 5px 5px 15px 0; padding: 8px 16px; font-weight: bold; }
    .card { border: 1px solid #ccc; border-radius: 6px; padding: 10px; margin-bottom: 12px; background: #f7f7f7; }
    table { border-collapse: collapse; width: 100%; margin-top: 10px; font-size: 14px; }
    th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
    th { background: #eee; }
    .buy { color: red; font-weight: bold; }
    .sell { color: blue; font-weight: bold; }
  </style>
</head>
<body>

<h1>🐋 고래 모니터링 대시보드</h1>

<!-- 탭 버튼 -->
<div>
  <button onclick="showTab('price')">💰 시세</button>
  <button onclick="showTab('news')">📰 뉴스</button>
  <button onclick="showTab('economic')">📅 경제지표</button>
  <button onclick="showTab('whale')">🐳 고래 거래</button>
</div>

<!-- 시세 탭 -->
<div id="price" class="tab active">
  <h2>💰 실시간 시세</h2>
  <div id="priceCards"></div>
</div>

<!-- 뉴스 탭 -->
<div id="news" class="tab">
  <h2>📰 코인 뉴스 요약</h2>
  <div id="newsList"></div>
</div>

<!-- 경제지표 탭 -->
<div id="economic" class="tab">
  <h2>📅 주요 경제지표</h2>
  <table>
    <thead><tr><th>날짜</th><th>지표명</th><th>국가</th><th>해석</th></tr></thead>
    <tbody id="economicTable"></tbody>
  </table>
</div>

<!-- 고래 분석 탭 -->
<div id="whale" class="tab">
  <h2>🐳 BTC 고래 거래</h2>
  <table>
    <thead><tr><th>시간</th><th>From</th><th>To</th><th>수량</th><th>구간</th><th>매수/매도</th></tr></thead>
    <tbody id="btcTable"></tbody>
  </table>
  <h2>🧊 HBAR 고래 거래</h2>
  <table>
    <thead><tr><th>시간</th><th>From</th><th>To</th><th>수량</th><th>구간</th><th>매수/매도</th></tr></thead>
    <tbody id="hbarTable"></tbody>
  </table>
</div>

<script>
function showTab(tabId) {
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.getElementById(tabId).classList.add('active');
}

async function loadPrices() {
  const res = await fetch("/api/price");
  const data = await res.json();
  const wrap = document.getElementById("priceCards");
  wrap.innerHTML = Object.entries(data).map(([key, d]) => `
    <div class="card">
      <h3>${key}</h3>
      <p>가격: $${d.price.toLocaleString()}</p>
      <p>24시간 변동률: ${d.change >= 0 ? '+' : ''}${d.change}%</p>
    </div>
  `).join('');
}

async function loadNews() {
  const res = await fetch("/api/news");
  const news = await res.json();
  document.getElementById("newsList").innerHTML = news.map(n => `
    <div class="card">
      <a href="${n.link}" target="_blank"><strong>${n.title}</strong></a><br>
      <small>🕒 ${n.published}</small>
    </div>
  `).join('');
}

async function loadEconomic() {
  const res = await fetch("/api/economics");
  const data = await res.json();
  document.getElementById("economicTable").innerHTML = data.map(e => `
    <tr><td>${e.date}</td><td>${e.event}</td><td>${e.country}</td><td>${e.impact}</td></tr>
  `).join('');
}

async function loadWhales() {
  const btc = await fetch("/api/btc_trades").then(r => r.json());
  const hbar = await fetch("/api/hbar_trades").then(r => r.json());

  document.getElementById("btcTable").innerHTML = btc.map(t => `
    <tr>
      <td>${t.time}</td><td>${t.from}</td><td>${t.to}</td><td>${t.amount}</td><td>${t.type}</td>
      <td class="${t.direction === '매수' ? 'buy' : 'sell'}">${t.direction}</td>
    </tr>
  `).join('');

  document.getElementById("hbarTable").innerHTML = hbar.map(t => `
    <tr>
      <td>${t.time}</td><td>${t.from}</td><td>${t.to}</td><td>${t.amount}</td><td>${t.type}</td>
      <td class="${t.direction === '매수' ? 'buy' : 'sell'}">${t.direction}</td>
    </tr>
  `).join('');
}

function loadAll() {
  loadPrices();
  loadNews();
  loadEconomic();
  loadWhales();
}

loadAll();
setInterval(loadAll, 30000);
</script>

</body>
</html>