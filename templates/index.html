<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>📈 실시간 고래 거래량 (30초 단위 / 한국시간)</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <h2>🟠 비트코인 고래 거래량 (최근 30분)</h2>
  <canvas id="btcChart"></canvas>

  <h2>🔵 헤데라 고래 거래량 (최근 30분)</h2>
  <canvas id="hbarChart"></canvas>

  <script>
    const btcCtx = document.getElementById('btcChart').getContext('2d');
    const hbarCtx = document.getElementById('hbarChart').getContext('2d');

    const createChart = (ctx, label) => new Chart(ctx, {
      type: 'line',
      data: {
        labels: [],
        datasets: [
          { label: '0-1 단위', data: [], borderWidth: 2 },
          { label: '1-10 단위', data: [], borderWidth: 2 },
          { label: '10-100 단위', data: [], borderWidth: 2 },
          { label: '100+ 단위', data: [], borderWidth: 2 }
        ]
      },
      options: {
        responsive: true,
        animation: false,
        scales: {
          x: {
            title: { display: true, text: '시간 (KST)' }
          },
          y: {
            beginAtZero: true,
            title: { display: true, text: '거래 수량' }
          }
        },
        plugins: {
          tooltip: { enabled: true },
          legend: { position: 'top' }
        }
      }
    });

    const btcChart = createChart(btcCtx, 'BTC');
    const hbarChart = createChart(hbarCtx, 'HBAR');

    const updateChart = async (url, chart) => {
      const res = await fetch(url);
      const data = await res.json();
      chart.data.labels = data.map(d => d.time);
      chart.data.datasets[0].data = data.map(d => d.data["0-1"]);
      chart.data.datasets[1].data = data.map(d => d.data["1-10"]);
      chart.data.datasets[2].data = data.map(d => d.data["10-100"]);
      chart.data.datasets[3].data = data.map(d => d.data["100+"]);
      chart.update();
    };

    const updateCharts = () => {
      updateChart("/api/btc", btcChart);
      updateChart("/api/hbar", hbarChart);
    };

    updateCharts(); // 최초 실행
    setInterval(updateCharts, 30000); // ⏱ 30초마다 실행
  </script>
</body>
</html>