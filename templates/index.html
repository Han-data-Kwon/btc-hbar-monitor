<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>📈 실시간 고래 추적 대시보드</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: 'Arial'; padding: 20px; background: #fff; color: #000; transition: 0.3s; }
    .dark-mode { background: #121212; color: #eee; }
    .tab { display: none; }
    .tab.active { display: block; }
    .tabs button { margin-right: 10px; padding: 8px 16px; font-weight: bold; }
    .card { border: 1px solid #ccc; border-radius: 6px; padding: 12px; margin-bottom: 10px; background: #f8f8f8; }
    .dark-mode .card { background: #2e2e2e; border-color: #444; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 14px; }
    th, td { border: 1px solid #aaa; padding: 6px; text-align: center; }
    th { background: #ddd; }
    .dark-mode th { background: #444; }
    .buy { color: red; font-weight: bold; }
    .sell { color: blue; font-weight: bold; }
  </style>
</head>
<body>

<h1>🐋 실시간 고래 추적 대시보드</h1>
<button onclick="toggleDarkMode()">🌙 다크모드 전환</button>

<div class="tabs">
  <button onclick="showTab('indicators')">📊 코인 지표</button>
  <button onclick="showTab('news')">📰 뉴스 요약</button>
  <button onclick="showTab('economics')">📅 경제지표</button>
  <button onclick="showTab('whale')">🐳 고래 거래 분석</button>
</div>

<!-- 📊 코인 지표 -->
<div id="indicators" class="tab active">
  <h2>📊 주요 코인 시세</h2>
  <div id="priceCards" class="grid"></div>
</div>

<!-- 📰 뉴스 요약 -->
<div id="news" class="tab">
  <h2>📰 최신 코인 뉴스 요약</h2>
  <div id="newsList"></div>
</div>

<!-- 📅 경제지표 -->
<div id="economics" class="tab">
  <h2>📅 주요 경제지표 및 해석</h2>
  <table>
    <thead><tr><th>지표</th><th>발표일</th><th>영향도</th><th>해석</th></tr></thead>
    <tbody id="econTable"></tbody>
  </table>
</div>

<!-- 🐳 고래 분석 -->
<div id="whale" class="tab">
  <h2>🐳 BTC 고래 거래</h2>
  <table>
    <thead><tr><th>시간</th><th>From</th><th>To</th><th>수량</th><th>구간</th><th>매수/매도</th></tr></thead>
    <tbody id="btcTable"></tbody>
  </table>
  <h2>🧊 HBAR 고래 거래</h2>
  <table>
    <thead><tr><th>시간</th><th>From</th><th>To</th><th>수량</th><th>구간</th><th>매수/매도</th></tr></thead>
    <tbody id="hbarTable"></tbody>
  </table>
</div>

<script>
function showTab(id) {
  document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function toggleDarkMode() {
  document.body.classList.toggle('dark-mode');
}

async function loadPrices() {
  const res = await fetch("/api/price");
  const data = await res.json();
  const wrap = document.getElementById("priceCards");
  wrap.innerHTML = Object.entries(data).map(([key, d]) => `
    <div class="card">
      <h3>${key}</h3>
      <p>가격: $${d.price.toLocaleString()}</p>
      <p>변동률: ${d.change >= 0 ? '+' : ''}${d.change}%</p>
    </div>
  `).join('');
}

async function loadNews() {
  const res = await fetch("/api/news");
  const data = await res.json();
  document.getElementById("newsList").innerHTML = data.map(n => `
    <div class="card">
      <a href="${n.link}" target="_blank"><strong>${n.title}</strong></a>
      <p>${n.summary}</p>
      <small>발행일: ${n.published}</small>
    </div>
  `).join("");
}

async function loadEcon() {
  const res = await fetch("/api/economic");
  const data = await res.json();
  document.getElementById("econTable").innerHTML = data.map(e => `
    <tr><td>${e.event}</td><td>${e.date}</td><td>${e.impact}</td><td>${e.interpret}</td></tr>
  `).join('');
}

async function loadWhale() {
  const btc = await fetch("/api/btc_trades").then(r => r.json());
  const hbar = await fetch("/api/hbar_trades").then(r => r.json());

  document.getElementById("btcTable").innerHTML = btc.map(t => `
    <tr>
      <td>${t.time}</td><td>${t.from}</td><td>${t.to}</td><td>${t.amount}</td>
      <td>${t.type}</td><td class="${t.direction === '매수' ? 'buy' : 'sell'}">${t.direction}</td>
    </tr>
  `).join('');

  document.getElementById("hbarTable").innerHTML = hbar.map(t => `
    <tr>
      <td>${t.time}</td><td>${t.from}</td><td>${t.to}</td><td>${t.amount}</td>
      <td>${t.type}</td><td class="${t.direction === '매수' ? 'buy' : 'sell'}">${t.direction}</td>
    </tr>
  `).join('');
}

function loadAll() {
  loadPrices();
  loadNews();
  loadEcon();
  loadWhale();
}

loadAll();
setInterval(loadAll, 30000);
</script>

</body>
</html>