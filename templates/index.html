<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>고래 모니터링 대시보드</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-streaming@2.0.0"></script>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background-color: white;
      color: black;
      margin: 0;
      padding: 20px;
      transition: background-color 0.3s, color 0.3s;
    }
    .dark-mode {
      background-color: #121212;
      color: white;
    }
    h1 {
      font-size: 32px;
    }
    .tabs button {
      margin-right: 10px;
      padding: 10px 15px;
      font-size: 16px;
      border: 1px solid #ccc;
      background-color: #eee;
      cursor: pointer;
      border-radius: 6px;
    }
    .tabs button.active {
      background-color: white;
      font-weight: bold;
      border: 2px solid black;
    }
    .content {
      margin-top: 20px;
    }
    .card {
      display: inline-block;
      border: 1px solid #ccc;
      border-radius: 10px;
      padding: 20px;
      margin: 10px;
      width: 250px;
      vertical-align: top;
    }
    .news-card img {
      width: 100%;
      height: 100px;
      object-fit: cover;
    }
    .dark-mode .card {
      background-color: #222;
      color: white;
      border: 1px solid #555;
    }
    .toggle-btn {
      float: right;
      padding: 8px 16px;
      font-size: 14px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      padding: 10px;
      border: 1px solid #ddd;
    }
    th {
      background-color: #f2f2f2;
    }
    .dark-mode th {
      background-color: #333;
    }
  </style>
</head>
<body>
  <h1>🐋 고래 모니터링 대시보드</h1>
  <button class="toggle-btn" onclick="toggleDarkMode()">🌙 다크모드</button>

  <div class="tabs">
    <button class="tab-btn active" onclick="showTab('price')">💰 시세</button>
    <button class="tab-btn" onclick="showTab('news')">📰 뉴스</button>
    <button class="tab-btn" onclick="showTab('economics')">📊 경제지표</button>
    <button class="tab-btn" onclick="showTab('whales')">🐳 고래 거래</button>
  </div>

  <div id="price" class="content">
    <h2>💰 주요 코인 시세</h2>
    <div id="price-cards"></div>
  </div>

  <div id="news" class="content" style="display: none;">
    <h2>📰 Cointelegraph 뉴스</h2>
    <div id="news-section"></div>
  </div>

  <div id="economics" class="content" style="display: none;">
    <h2>📊 주요 경제지표</h2>
    <table>
      <thead>
        <tr>
          <th>날짜</th><th>지표명</th><th>국가</th><th>이전</th><th>예측</th><th>실제</th><th>해석</th>
        </tr>
      </thead>
      <tbody id="eco-table"></tbody>
    </table>
  </div>

  <div id="whales" class="content" style="display: none;">
    <h2>🐳 고래 거래</h2>
    <p>이전 고래 거래 탭 코드 유지</p>
  </div>

  <script>
    function toggleDarkMode() {
      document.body.classList.toggle("dark-mode");
    }

    function showTab(id) {
      document.querySelectorAll(".content").forEach(el => el.style.display = "none");
      document.querySelectorAll(".tab-btn").forEach(btn => btn.classList.remove("active"));
      document.getElementById(id).style.display = "block";
      event.target.classList.add("active");
    }

    // 시세 불러오기
    fetch('/api/price')
      .then(res => res.json())
      .then(data => {
        const container = document.getElementById('price-cards');
        Object.entries(data).forEach(([symbol, info]) => {
          const color = info.change >= 0 ? 'green' : 'red';
          container.innerHTML += `
            <div class="card">
              <h3>${symbol}</h3>
              <p style="color:${color}">$ ${info.price}</p>
              <p style="color:${color}">📉 변화율: ${info.change}%</p>
              <canvas id="chart-${symbol}" height="50"></canvas>
            </div>`;
        });

        // 더미 차트 생성
        Object.keys(data).forEach(symbol => {
          const ctx = document.getElementById(`chart-${symbol}`).getContext('2d');
          new Chart(ctx, {
            type: 'line',
            data: {
              labels: ["1H", "30M", "15M", "5M", "1M"],
              datasets: [{
                label: symbol,
                data: Array.from({length: 5}, () => Math.random() * 1000),
                borderWidth: 1,
                fill: false,
              }]
            },
            options: {
              plugins: { legend: { display: false } },
              scales: { x: { display: false }, y: { display: false } }
            }
          });
        });
      });

    // 뉴스 불러오기
    fetch('/api/news')
      .then(res => res.json())
      .then(news => {
        const container = document.getElementById('news-section');
        news.forEach(article => {
          container.innerHTML += `
            <div class="card news-card">
              <img src="${article.image}" />
              <h4><a href="${article.link}" target="_blank">${article.title}</a></h4>
              <small>${article.date}</small>
            </div>`;
        });
      });

    // 경제지표 불러오기
    fetch('/api/economics')
      .then(res => res.json())
      .then(data => {
        const table = document.getElementById('eco-table');
        if (data.length === 0) {
          table.innerHTML = '<tr><td colspan="7">표시할 데이터가 없습니다.</td></tr>';
          return;
        }
        data.forEach(item => {
          table.innerHTML += `
            <tr>
              <td>${item.date}</td>
              <td>${item.event}</td>
              <td>${item.country}</td>
              <td>${item.previous || '-'}</td>
              <td>${item.forecast || '-'}</td>
              <td>${item.actual || '-'}</td>
              <td>${item.effect}</td>
            </tr>`;
        });
      });
  </script>
</body>
</html>